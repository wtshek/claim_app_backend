var avaMediaSelectorSettings={title:"",url1:"",url2:""};!function(e,a){"use strict";function n(e,a){for(var n,t=[],r=0;r<e.length;++r){if(n=l[e[r]]||i(e[r]),!n)throw"module definition dependecy not found: "+e[r];t.push(n)}a.apply(null,t)}function t(e,t,i){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(t===a)throw"invalid module definition, dependencies must be specified";if(i===a)throw"invalid module definition, definition function must be specified";n(t,function(){l[e]=i.apply(null,arguments)})}function i(a){for(var n=e,t=a.split(/[.\/]/),i=0;i<t.length;++i){if(!n[t[i]])return;n=n[t[i]]}return n}function r(n){for(var t=0;t<n.length;t++){for(var i=e,r=n[t],o=r.split(/[.\/]/),d=0;d<o.length-1;++d)i[o[d]]===a&&(i[o[d]]={}),i=i[o[d]];i[o[o.length-1]]=l[r]}}var l={};t("avalade/util/Loader",[],function(){function e(){}function a(e){document.getElementsByTagName("head")[0].appendChild(e)}var n=0,t={},i={maxLoadTime:5,load:function(e,a,n){function t(){o.length?i.loadScript(o.shift(),t,n):r()}function r(){l.length?i.loadCss(l.shift(),r,n):a()}var l=e.css||[],o=e.js||[];t()},loadScript:function(n,i,r){function l(){t[n]=!0,i()}var o,d;if(t[n])return void i();if(i=i||e,r=r||e,d=document.createElement("script"),d.type="text/javascript","object"==typeof n)for(o in n)d.setAttribute(o,n[o]);else d.src=n;"onload"in d?(d.onload=l,d.onerror=r):(d.onreadystatechange=function(){var e=d.readyState;("complete"==e||"loaded"==e)&&l()},d.onerror=r),a(d)},loadCss:function(r,l,o){function d(){t[r]=!0,l()}function u(){var e=navigator.userAgent.match(/WebKit\/(\d*)/);return!!(e&&e[1]<536)}function c(){for(var e,a,n=g.styleSheets,t=n.length;t--;)if(e=n[t],a=e.ownerNode?e.ownerNode:e.owningElement,a&&a.id===f.id)return void d();(new Date).getTime()-v<1e3*i.maxLoadTime?window.setTimeout(c,0):o()}function s(){try{var e=m.sheet.cssRules;return d(),e}catch(a){}(new Date).getTime()-v<1e3*i.maxLoadTime?window.setTimeout(s,0):o()}var f,m,v,g=document;if(t[r])return void l();if(l=l||e,o=o||e,f=g.createElement("link"),f.rel="stylesheet",f.type="text/css",f.href=r,f.id="u"+n++,v=(new Date).getTime(),"onload"in f&&!u())f.onload=d,f.onerror=o;else{if(navigator.userAgent.indexOf("Firefox")>0)return m=g.createElement("style"),m.textContent='@import "'+r+'"',s(),void a(m);c()}a(f)}};return i}),t("avalade/Env",[],function(){return{apiPageName:"api.php",ie7:document.all&&!window.opera&&!document.documentMode}}),t("avalade/util/I18n",[],function(){function e(e){for(var a=window,n=e.split(/\//),t=0;t<n.length;++t){if(!a[n[t]])return;a=a[n[t]]}return a}var a=e("avalade/util/I18n");if(a)return a;var n={};return{add:function(e,a){for(var t in a)n[t]=a[t]},translate:function(e){if("undefined"==typeof e)return e;if("string"!=typeof e&&"raw"in e)return e.raw;if(e.push){var a=e.slice(1);e=(n[e[0]]||e[0]).replace(/\{([^\}]+)\}/g,function(e,n){return a[n]})}return n[e]||e},data:n}}),t("avalade/Loader",["avalade/util/Loader","avalade/Env","avalade/util/I18n"],function(e,a,n){function t(t){return function(i){function r(){avalade.Env.baseUrl=a.baseUrl,avalade.Env.apiPageUrl=a.baseUrl+"/"+a.apiPageName,avalade.util.JsonRpc.url=avalade.Env.apiPageUrl,avalade.ui.Control.translate=n.translate,avalade.ui.FloatPanel.zIndex=i.zIndex||avalade.ui.FloatPanel.zIndex;var e=new avalade.Manager(i);e.init(new avalade.views[t](e))}if(i=i||{},!a.baseUrl)for(var l=document.getElementsByTagName("script"),o=0;o<l.length;o++){var d=l[o].src;if(/(^|\/)avalade\./.test(d)){a.baseUrl=d.substring(0,d.lastIndexOf("/"))+"/..",a.apiPageUrl=a.baseUrl+"/"+a.apiPageName;break}}avalade.ui?r():e.load({js:[a.baseUrl+"/js/moxman.api.min.js",a.apiPageUrl+"?action=language"+(i.language?"&code="+i.language:""),a.apiPageUrl+"?action=PluginJs"],css:[a.baseUrl+"/skins/lightgray/skin"+(a.ie7?".ie7":"")+".min.css"]},r)}}var i=this||window,r={browse:t("FileListView"),upload:t("UploadView"),edit:t("EditView"),zip:t("ZipView"),createDir:t("CreateDirView"),createDoc:t("CreateDocView"),view:t("ViewFileView"),rename:t("RenameView")};i.avalade=i.avalade||{};for(var l in r)i.avalade[l]=r[l];return i.avalade.addI18n=n.add,r}),t("avalade/avaMediaSelector",["avalade/Loader","avalade/Env"],function(e,n){tinymce.PluginManager.add("avaMediaSelector",function(n,t){function i(e){var a={};tinymce.each(l,function(e,n){0===n.indexOf("avamedia_")&&(a[n.substring(13)]=e)});var n=l["avamedia_"+e+"_settings"];return n&&tinymce.each(n,function(e,n){n=n.replace(/avamediar_/g,""),a[n]=e}),a}function r(e,a,n){function t(e,a){var n,t;for(n=0,t=e,a=a.split(".");n<a.length;n++)t=t[a[n]];return t}return"string"!=typeof e?e(a,n):(e=""+e.replace(/\{\$([^\}]+)\}/g,function(e,i){var r,l=i.split("|"),o=t(a,l[0]);if("undefined"==typeof o)return"";for(1==l.length&&n&&n.xmlEncode&&(o=n.xmlEncode(o)),r=1;r<l.length;r++)o=n[l[r]](o,a,i);return o}),e=e.replace(/\{\=([\w]+)([^\}]+)\}/g,function(e,i,r){return t(n,i)(a,i,r)}))}var l=n.settings;l.file_browser_callback=function(e,t,i,r){var l=n.windowManager.zIndex,o={},d={image:{value:1,label:"image"},file:{value:2,label:"link"},media:{value:3,label:"video"}},u="&field_id="+encodeURIComponent(e)+"&type="+d[i].value;tinymce.ui.FloatPanel&&(l=tinymce.ui.FloatPanel.currentZIndex);var c=[];avaMediaSelectorSettings.url1!=a&&""!=avaMediaSelectorSettings.url1&&c.push({title:""==avaMediaSelectorSettings.title?"Shared Files":avaMediaSelectorSettings.title,type:"iframe",minWidth:950,minHeight:500,url:avaMediaSelectorSettings.url1+u}),avaMediaSelectorSettings.url2!=a&&""!=avaMediaSelectorSettings.url2&&c.push({title:"Page Specific Files",type:"iframe",minWidth:950,minHeight:500,url:avaMediaSelectorSettings.url2+u}),n.windowManager.open({title:"Insert/edit "+d[i].label,data:o,bodyType:"tabpanel",body:c,buttons:[]},{body:$(document).find("body")[0],pane:l-1,panel:tinymce.ui.FloatPanel})},n.addCommand("mceInsertFile",function(){function a(e,a){return r(e,a,{urlencode:function(e){return encodeURIComponent(e)},xmlEncode:function(e){return tinymce.DOM.encode(e)},sizeSuffix:function(e){return-1==e?"":e>1048576?Math.round(e/1048576,1)+" MB":e>1024?Math.round(e/1024,1)+" KB":e+" b"}})}var t,o=n.selection;t=o.getRng();var d=n.windowManager.zIndex;tinymce.ui.FloatPanel&&(d=tinymce.ui.FloatPanel.currentZIndex),e.browse(tinymce.extend({zIndex:d,document_base_url:l.document_base_url,oninsert:function(e){var i="";tinymce.each(e.files,function(e,r){var l=/\.(gif|jpe?g|png)$/i.test(e.name);return o.setRng(t),l||o.isCollapsed()?(r>0&&(i+=" "),void(i+=l?a(n.getParam("moxiemanager_image_template",'<img src="{$meta.url}" width="{$meta.width}" height="{$meta.height}">'),e):a(n.getParam("moxiemanager_file_template",'<a href="{$url}">{$name}</a>'),e))):(n.execCommand("mceInsertLink",e.meta.url),!1)}),o.setRng(t),n.execCommand("mceInsertContent",!1,i)}},i()))}),tinymce.Env?n.addButton("insertfile",{icon:"browse",title:"Insert file",cmd:"mceInsertFile"}):n.addButton("insertfile",{image:t+"/skins/lightgray/img/insertfile.gif",title:n.getLang("moxiemanager_insert","Insert file"),cmd:"mceInsertFile"})})}),r(["avalade/util/Loader","avalade/Env","avalade/util/I18n","avalade/Loader","avalade/avaMediaSelector"])}(this);